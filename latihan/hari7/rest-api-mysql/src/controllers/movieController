const { connectionPool } = require('../config/db')

const createMovie = (req, res) => {
    let {title, year} = req.body

    let queryText = `INSERT INTO movies (title, year, created_at, change_at) VALUES("${title}", ${year}, now(), now())`

    connectionPool.query(queryText, (err) => {
        if(err){
            console.log(err)
            return
        }
    })

    res.json({'message': 'Movie Was Succesfully Created', 'status': 'success'})
}

const readMovie = (req, res) => {
    let queryText = "SELECT * FROM movies"
    connectionPool.query(queryText, (err, data) => {

    if (err) {
    console.error(err);
    return;
    }
    res.json(data);
    });
}

const readMovieById = (req, res) => {
    let {id} = req.params
    let queryText = `SELECT * FROM movies WHERE id=${id}`
    connectionPool.query(queryText, (err, data) => {
        if (err) {
        console.error(err);
        return;
    }
        res.json(data);
    });
}

const updateMovie = (req, res) => {
    let {title, year} = req.body
    let {id} = req.params
    let queryText = `UPDATE movies SET title="${title}", year=${year}, created_at=now(), change_at=now() 
                     WHERE id=${id}`
    connectionPool.query(queryText, (err, data) => {
        if (err) {
        console.error(err);
        return;
    }
        res.json("Data telah terupdate");
    });
}

const deleteMovie = (req, res) => {
    let {id} = req.params
    let queryText = `DELETE FROM movies WHERE id=${id}`
    connectionPool.query(queryText, (err, data) => {
        if (err) {
        console.error(err);
        return;
    }
        res.json("Data telah dihapus");
    });
}

module.exports = {createMovie, readMovie, readMovieById, updateMovie, deleteMovie}